<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>API Gateway</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-interactiveBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="c14b044b-44f8-4519-8432-c631cb04de2a" class="page sans"><header><h1 class="page-title">API Gateway</h1><p class="page-description"></p></header><div class="page-body"><nav id="6c7d2a70-b6e5-4f1e-b80d-5d82be3d434f" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#e2376c24-940a-4819-8e41-2d916befae37">Intro</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#88bf0f08-e712-42ac-875a-b00f48279fb2">Integration</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#d8c98d10-d401-4e5d-9a47-1628fb85caaf">Integration Types</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#63cca361-02e4-45bf-972e-bbb82bf8f271">Mapping Templates</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#452e8f39-6d1d-4d6c-ac40-b39440250d10">Endpoint Types</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#8198a3de-80ae-4c4e-9d4f-7f9cef70afd5">Deployments</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#b786a95d-3a1f-44ee-811c-df55a2b65094">Stage Variables</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#e8e4d80b-4429-434a-96a7-06aa637d0e9b">Canary Deployment</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#4c34adb7-6b45-4e07-8d3a-7c2f1dbd7929">OpenAPI Spec</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#29b7a17c-bde7-4faa-9a1b-c40de7ced0db">Caching API Responses</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#c33eae45-88b5-4019-9716-f4464431cb55">Cache Invalidation</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#3547d3bf-661b-49fa-8100-053f8efa76d9"> Usage Plans</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#aebf7200-8602-4f9a-9455-bd7080163255">Steps to setup a Usage Plan</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#51d508cb-19a4-484b-a7d1-866329457979">Observability</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#622af6f1-e784-437a-a6a0-5a3ca73cdac3">Logging</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#6ac080e4-de36-434b-897c-40362fae784b">Tracing</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#b7673231-8e0b-4e72-9e91-7b237976c472">Metrics</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#33da31e3-ff23-42b5-8737-d2abf358c3f5">Performance</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#e7b07926-841f-4ac5-888a-1ee41d3e324c">Cross Origin Resource Sharing (CORS)</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#90d9b2a1-916a-4c97-8429-f816eaf5cc9e">TLS Termination</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#92f4174b-c8bf-4e3f-ab71-3140f19df876">User Authentication</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#39597bd3-127b-4e76-b0ef-0ba46c83bd72">IAM</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#98ac2b6c-cb58-459f-90f3-f8357cbf74f2">Cognito User Pools (CUP)</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#5c835444-18fc-4d24-9798-35926c2e9c94">Lambda Authorizer</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#72cb7920-13c9-4a56-83a1-b1266e39d17e">API Types</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#0ad96b96-a690-4927-a529-a9636e26e8c9"><strong>REST</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#3f9c2c9d-ab9d-42eb-b2ad-87451ec95163"><strong>HTTP</strong></a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#8946b2f7-6edf-408c-abe9-f8322d975349"><strong>WebSocket</strong></a></div></nav><hr id="61d695ab-1260-44f6-adcd-9f65911f8f28"/><h2 id="e2376c24-940a-4819-8e41-2d916befae37" class="">Intro</h2><ul id="ef48cd9f-f71a-4589-8c3d-4fda89243283" class="bulleted-list"><li style="list-style-type:disc">Serverless REST APIs with <strong>TLS termination</strong> (all of the APIs created with API Gateway expose <strong>HTTPS</strong> endpoints only)</li></ul><ul id="3406db7f-ef3d-4507-a946-86132aa2fc89" class="bulleted-list"><li style="list-style-type:disc">API versioning</li></ul><ul id="6f36d468-cf55-480a-8ee8-f25cd2869dab" class="bulleted-list"><li style="list-style-type:disc">Multiple environment (dev, test, prod)</li></ul><ul id="a6c1524d-fe0f-4bf7-99cd-d062c1362085" class="bulleted-list"><li style="list-style-type:disc">Request throttling</li></ul><ul id="ea2b20e3-9242-4880-93cb-767eb2b0608b" class="bulleted-list"><li style="list-style-type:disc">Authentication and Authorization</li></ul><ul id="3772c1b8-9da0-4985-9aaa-c06dab73cd30" class="bulleted-list"><li style="list-style-type:disc">Supports API keys</li></ul><ul id="bd4682ec-97ed-49cd-9453-79e650c049df" class="bulleted-list"><li style="list-style-type:disc">Supports <strong>WebSocket</strong></li></ul><ul id="59da7688-2d32-4ce9-9f8e-a7cb87ce6ce9" class="bulleted-list"><li style="list-style-type:disc">Cache API responses</li></ul><ul id="a7dd8eea-05ab-4959-bcbb-f452e4239658" class="bulleted-list"><li style="list-style-type:disc">Generate SDK and API specifications</li></ul><ul id="bf5bf6a1-c449-403e-a2bf-671a537b9eb0" class="bulleted-list"><li style="list-style-type:disc">Swagger / OpenAPI config supported (import or export)</li></ul><ul id="9d03d89f-88c0-4589-ace4-fc8c3b8280a7" class="bulleted-list"><li style="list-style-type:disc">Transform and validate requests and responses</li></ul><ul id="b1a25d7e-21f6-485d-babe-576b0294ca2c" class="bulleted-list"><li style="list-style-type:disc">Firewall can be implemented using Web Application Firewall (WAF)</li></ul><h2 id="88bf0f08-e712-42ac-875a-b00f48279fb2" class="">Integration</h2><h3 id="d8c98d10-d401-4e5d-9a47-1628fb85caaf" class="">Integration Types</h3><ul id="63b7cf06-a9d5-4d2f-9f22-54e7d3585b5b" class="bulleted-list"><li style="list-style-type:disc"><code>MOCK</code> - API gateway returns a mock (hardcoded) response (useful in development)</li></ul><ul id="73ad45f4-9322-4758-bf95-ccf1889f6d45" class="bulleted-list"><li style="list-style-type:disc"><code>AWS_PROXY</code> (Lambda Proxy)<ul id="f444599c-a57c-496c-bee5-de8f49d08f7e" class="bulleted-list"><li style="list-style-type:circle">Incoming request from the client is <strong>proxied to the lambda function</strong> as a JSON event (request specific params like status code is automatically handled by API gateway)</li></ul><ul id="1e9c0379-0b48-45f6-8e41-633ab7d03f6a" class="bulleted-list"><li style="list-style-type:circle">Used to create serverless REST APIs</li></ul><ul id="d3324011-729f-4bad-943b-b2d2a93a9e41" class="bulleted-list"><li style="list-style-type:circle"><strong>Cannot modify the request &amp; response in API gateway</strong> (no mapping template)</li></ul><ul id="8629e42b-19e8-4f3e-ad82-00b6567c8818" class="bulleted-list"><li style="list-style-type:circle">The entire processing of request happens in the Lambda function</li></ul><figure id="90b42cd6-e076-47c4-b2e0-3f6ba48eb284" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled.png"><img style="width:528px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled.png"/></a></figure></li></ul><ul id="5d054da2-51fc-48eb-a5e9-682d39f806ed" class="bulleted-list"><li style="list-style-type:disc"><code>AWS</code><ul id="fd99f2c6-d40f-4d2a-aa23-e388702d8b95" class="bulleted-list"><li style="list-style-type:circle">To integrate with AWS resources or a Lambda function (custom integration)</li></ul><ul id="d7cab23e-f4b1-4f5e-8695-fc03ad137781" class="bulleted-list"><li style="list-style-type:circle">Can modify integration requests and responses using <strong>mapping templates</strong></li></ul></li></ul><ul id="b0555ed4-ae38-461d-91e6-5be66bd553a9" class="bulleted-list"><li style="list-style-type:disc"><code>HTTP_PROXY</code> <ul id="3c3d0248-56f0-4f12-8bdd-5ab02175cd09" class="bulleted-list"><li style="list-style-type:circle">Incoming request is proxied to any HTTP backend</li></ul><ul id="c57087e3-06af-4168-9a2f-c3901a620c5f" class="bulleted-list"><li style="list-style-type:circle"><strong>Request &amp; response cannot be modified</strong> (no mapping template)</li></ul><ul id="4b8f8ede-e307-4ce8-aa19-d22a56a4880b" class="bulleted-list"><li style="list-style-type:circle">Option to add HTTP headers in the request (eg. API key)</li></ul><figure id="8c9a2023-b3a4-4922-a99d-7f5df785ddc2" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%201.png"><img style="width:528px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%201.png"/></a></figure></li></ul><ul id="ef9f9170-37ec-4ecc-813e-d67538b962af" class="bulleted-list"><li style="list-style-type:disc"><code>HTTP</code><ul id="0df0fc31-b329-45f9-86e5-7e8c57dd59be" class="bulleted-list"><li style="list-style-type:circle">To integrate with any HTTP endpoint</li></ul><ul id="4f1e27a6-4223-458f-bfca-df0195fa9450" class="bulleted-list"><li style="list-style-type:circle">Can modify integration requests and responses using <strong>mapping templates</strong></li></ul><figure id="144a643b-7d2e-4a4c-b1dd-6fa098eee266" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%202.png"><img style="width:432px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%202.png"/></a></figure></li></ul><h3 id="63cca361-02e4-45bf-972e-bbb82bf8f271" class="">Mapping Templates</h3><ul id="55b7766c-832b-47d1-91df-9e55e9de3206" class="bulleted-list"><li style="list-style-type:disc">Used to modify requests and responses<ul id="923f803e-6452-4c18-be48-5ef9b4d98371" class="bulleted-list"><li style="list-style-type:circle">Modify query string parameters</li></ul><ul id="9e63e8ef-54ef-4796-863f-9c752449b293" class="bulleted-list"><li style="list-style-type:circle">Modify body content</li></ul><ul id="4194efdc-8b78-4820-928d-76c23ee0aa0a" class="bulleted-list"><li style="list-style-type:circle">Add headers</li></ul></li></ul><ul id="ded5ea25-db36-40eb-8943-10357ae626b8" class="bulleted-list"><li style="list-style-type:disc">Uses <strong>Velocity Template Language (VTL)</strong></li></ul><ul id="d4ebec8b-803f-4761-a389-08d463d0f881" class="bulleted-list"><li style="list-style-type:disc"><code>Content-Type</code> must be <code>application/json</code> or <code>application/xml</code></li></ul><ul id="5a554131-ba17-46f5-9ead-ab67d819ada7" class="toggle"><li><details open=""><summary>Example: Exposing a SOAP backend as a REST API</summary><p id="82bfad35-bd90-47a5-9936-e3e5fb7609be" class="">Use mapping template to convert requests and responses between JSON and XML.</p><figure id="1181acc6-b01b-4da4-8888-414390085627" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%203.png"><img style="width:528px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%203.png"/></a></figure></details></li></ul><h2 id="452e8f39-6d1d-4d6c-ac40-b39440250d10" class="">Endpoint Types</h2><ul id="8ac50cfa-1283-49a6-85e6-d06043a7eb9e" class="bulleted-list"><li style="list-style-type:disc"><strong>Edge-Optimized</strong> (default)<ul id="f2fe2292-1d96-45af-a290-7cd406768599" class="bulleted-list"><li style="list-style-type:circle">For global clients</li></ul><ul id="09f3962b-f1ce-411a-9906-b64b922ffb1b" class="bulleted-list"><li style="list-style-type:circle">Requests are routed through the CloudFront edge locations (improves latency)</li></ul><ul id="bef96437-ab7b-49f4-b84b-e1a4b23f8d70" class="bulleted-list"><li style="list-style-type:circle"><mark class="highlight-yellow_background">The API Gateway lives in only one region</mark> but it is accessible efficiently through edge locations</li></ul></li></ul><ul id="fa751a7f-b340-4199-8c7a-966d5c7112a0" class="bulleted-list"><li style="list-style-type:disc"><strong>Regional</strong><ul id="1cebba47-7d62-4ec9-8769-121db42cadff" class="bulleted-list"><li style="list-style-type:circle">For clients within the same region</li></ul><ul id="9aa71c0d-5bc3-424c-b23f-eeb90881c89e" class="bulleted-list"><li style="list-style-type:circle">Could manually combine with your own CloudFront distribution for global deployment (this way you will have more control over the caching strategies and the distribution)</li></ul></li></ul><ul id="d138cace-dcc3-45c5-a602-c4d612f53791" class="bulleted-list"><li style="list-style-type:disc"><strong>Private</strong><ul id="e1531768-09b2-4cec-ae1d-cb04f8b4a47e" class="bulleted-list"><li style="list-style-type:circle">Can only be accessed within your VPC using an <strong>Interface VPC endpoint</strong> (ENI)</li></ul><ul id="04d15c94-eb09-480a-9df6-f389e8d00a29" class="bulleted-list"><li style="list-style-type:circle">Use resource policy to define access</li></ul></li></ul><h2 id="8198a3de-80ae-4c4e-9d4f-7f9cef70afd5" class="">Deployments</h2><ul id="d3e6eee0-b2cc-4dbf-b850-053202506176" class="bulleted-list"><li style="list-style-type:disc">Deploy the API to get the API Gateway endpoint</li></ul><ul id="bbe3a739-8241-4e6e-9511-2ce13bc6de10" class="bulleted-list"><li style="list-style-type:disc">If you make changes to the API, a new version is internally created. You need to deploy the API for the changes to take effect. </li></ul><ul id="8a4a8573-d760-484d-84c5-4c559902125c" class="bulleted-list"><li style="list-style-type:disc"><strong>Versions (changes) are deployed to stages</strong> (no limit on the number of stages)</li></ul><ul id="9e4888e1-baf8-4183-a515-075189d7c453" class="bulleted-list"><li style="list-style-type:disc">Metrics and logs are separate for each stage</li></ul><ul id="9f4731fb-5cad-4eb0-8e50-7e5349a0103d" class="bulleted-list"><li style="list-style-type:disc">Each stage has independent configuration and can be rolled back to any version (the whole history of deployments to a stage is kept)</li></ul><ul id="cbb9bc57-8b25-499d-9b3c-23e548c2fb9f" class="toggle"><li><details open=""><summary>Handling breaking changes using multiple stages</summary><p id="751bcb3b-5604-479a-acc1-f1ae1885c022" class="">We want to create a new version of the application which involves breaking changes at the API level. In this case, we can deploy a new stage (v2) and build our new application there. Since multiple stages can co-exist, we can have both the versions working and once all the users have migrated to v2, we can bring down v1. </p><figure id="6bd078b8-ef68-42cf-95ca-396b4b576f18" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%204.png"><img style="width:1436px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%204.png"/></a></figure></details></li></ul><h3 id="b786a95d-3a1f-44ee-811c-df55a2b65094" class="">Stage Variables</h3><ul id="b897cbe9-4130-4f2e-a003-c61066829b20" class="bulleted-list"><li style="list-style-type:disc">Environment variables for API gateway</li></ul><ul id="51e453f4-21d2-45cc-bfce-4a0bb3829551" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-yellow_background">Can be changed without redeploying the API</mark></li></ul><ul id="265488b1-9c8a-45d6-a7df-bc5602567d06" class="bulleted-list"><li style="list-style-type:disc">Stage variables are passed to <strong>context</strong> object in lambda functions</li></ul><ul id="8cb00539-a4d6-4881-937a-3f00c7115fbb" class="bulleted-list"><li style="list-style-type:disc">Format to access stage variables in API gateway - <code>${stageVariables.variableName}</code></li></ul><ul id="453c758f-7819-4710-9620-56d6c4b602a1" class="toggle"><li><details open=""><summary>Example: Stage variables to point to Lambda Aliases</summary><p id="d35a61fd-3bf1-45d8-b66a-9b672fa213b9" class="">Stage variables can be used to point to different Lambda aliases. Each stage points to a different lambda alias depending on the value of a stage variable. To shift traffic, we can modify the alias weights without making changes to the API gateway.</p><figure id="3f397a97-8e89-4afb-a86b-81f7f2bdfcd7" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%205.png"><img style="width:1804px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%205.png"/></a></figure><p id="c3b607ba-854b-4241-be53-a003d6612911" class="">The lambda function in API gateway - <code>&lt;function-name&gt;:${stageVariables.variableName}</code></p><figure id="2885f97d-9251-4886-8b11-e2d1d3efa8d3" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%206.png"><img style="width:958px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%206.png"/></a></figure><p id="d05005bf-5e3e-43be-bc01-ce8104f0ad80" class="">This will require adding resource-based policies on all the aliases to allow the API gateway to invoke them.</p><figure id="8705182f-d90d-432f-91df-f235786edb08" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%207.png"><img style="width:1108px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%207.png"/></a></figure><p id="213887b6-05bc-4e64-bf27-62c8e581f58b" class="">For every stage, create a stage variable with the value as name of the alias it should point to. </p><figure id="43265d99-c6c3-417b-a00b-ac8dfb52ae23" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%208.png"><img style="width:1560px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%208.png"/></a></figure></details></li></ul><h3 id="e8e4d80b-4429-434a-96a7-06aa637d0e9b" class="">Canary Deployment</h3><div id="d8d9d50b-2a62-4113-99db-5919d7c8cd05" class="column-list"><div id="211db317-ed2b-48e0-bf87-a0121976cc9f" style="width:37.5%" class="column"><ul id="defd3fbd-ea57-4921-add0-ea25ed8abef4" class="bulleted-list"><li style="list-style-type:disc">Use a <strong>canary stage</strong> with the new application version</li></ul><ul id="038591c5-67fd-4492-9655-32c3b2640799" class="bulleted-list"><li style="list-style-type:disc">Can override stage variables for Canary deployment</li></ul></div><div id="a9094313-792c-4c3f-a769-dcbbfc22cd73" style="width:62.5%" class="column"><figure id="edbf6593-bc83-47a5-a0c1-b1523093ed8e" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%209.png"><img style="width:1184px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%209.png"/></a></figure></div></div><h2 id="4c34adb7-6b45-4e07-8d3a-7c2f1dbd7929" class="">OpenAPI Spec</h2><ul id="6d586b35-0a09-4971-91db-4a58eb44fb26" class="bulleted-list"><li style="list-style-type:disc">Define REST APIs as configuration (YAML or JSON)</li></ul><ul id="aa10066e-651f-41c0-9dd6-f3cd73b5cfbe" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-yellow_background">Also allows to import AWS specific parameters and extensions</mark></li></ul><ul id="452670ba-19aa-4fcc-bcf6-6bb5333c9d7e" class="bulleted-list"><li style="list-style-type:disc">Export as OpenAPI spec to generate SDK for clients</li></ul><ul id="f2b27853-8a4e-42b8-a407-db210a63d2ab" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-yellow_background">API schema can also be defined in the OpenAPI spec</mark><ul id="b4dc891a-8c89-4c36-8080-8f7e03529b82" class="bulleted-list"><li style="list-style-type:circle">Allows API gateway to validate incoming requests for correct schema</li></ul><ul id="fa39168a-8cd4-443f-ac72-12f74d03a492" class="bulleted-list"><li style="list-style-type:circle">Returns 400 status code if the validation fails</li></ul><ul id="6246d7c8-d8e4-481a-b4d3-a012c80b6edc" class="bulleted-list"><li style="list-style-type:circle">Reduces unnecessary calls to the backend</li></ul><ul id="92499e22-94f5-42c5-8da3-e5f6509d5223" class="toggle"><li><details open=""><summary>Examples</summary><figure id="4dd93e07-3232-43b7-a5c6-fa8413eb2166" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2010.png"><img style="width:336px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2010.png"/></a></figure><figure id="41321c14-654f-454f-a99a-1e2dbc3d29ed" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2011.png"><img style="width:576px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2011.png"/></a></figure><figure id="9eaf1fcd-34e4-47e6-95ce-cd4deccf1af9" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2012.png"><img style="width:962px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2012.png"/></a></figure><p id="48bdc036-7469-48c3-96b0-cb37ef5fa4a8" class="">
</p></details></li></ul></li></ul><h2 id="29b7a17c-bde7-4faa-9a1b-c40de7ced0db" class="">Caching API Responses</h2><div id="c507811a-1645-44f3-bb5a-4e25281770dd" class="column-list"><div id="71fc19e4-a58f-4af5-8a9b-e64730e4d806" style="width:62.5%" class="column"><ul id="d0697ad0-3687-45dd-8d2f-44b08ba07dc1" class="bulleted-list"><li style="list-style-type:disc">Reduces the number of calls made to the backend</li></ul><ul id="1c7fa64f-f141-4329-9ac4-f154a7860f48" class="bulleted-list"><li style="list-style-type:disc"><strong>TTL: 0 s - 1 h (default 300 sec)</strong></li></ul><ul id="568399c1-c6a4-43af-a8e9-803f5fde0671" class="bulleted-list"><li style="list-style-type:disc">Caching at the stage level</li></ul><ul id="e877dd60-033b-4d7b-b919-017bff91842a" class="bulleted-list"><li style="list-style-type:disc">Ability to override cache settings at the method level</li></ul><ul id="738b3a35-be0f-4b41-95be-70b026acb2da" class="bulleted-list"><li style="list-style-type:disc">Cache capacity: 0.5 GB - 237 GB</li></ul><ul id="bd67b2f9-9bb3-48e2-9ae7-2f386a719cd2" class="bulleted-list"><li style="list-style-type:disc">Cache can be encrypted</li></ul><ul id="812abc44-8dbd-4128-a010-3d8850b6f88e" class="bulleted-list"><li style="list-style-type:disc">Caching is expensive (use only in production)</li></ul><h3 id="c33eae45-88b5-4019-9716-f4464431cb55" class="">Cache Invalidation</h3><ul id="14d948fb-d680-4e4f-bc81-8e12d70cae68" class="bulleted-list"><li style="list-style-type:disc">Invalidate the entire cache from console</li></ul><ul id="f6f3407d-2af0-42b1-a128-b1d1a06c6715" class="toggle"><li><details open=""><summary><mark class="highlight-yellow_background">Clients can invalidate the cache</mark> for a request by adding a header <code>Cache-Control: max-age=0</code> in the request. This will send the request to the backend and update the cache with the response.</summary><p id="abbfbeff-c803-4250-9e90-f846b0a14405" class="">Recommended to impose an IAM policy to allow only the clients to invalidate the cache. <mark class="highlight-yellow_background">Without an IAM policy or Authorization Disabled, anyone can invalidate the cache.</mark></p><figure id="70db1fce-b970-42af-b249-7000d98cefed" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2013.png"><img style="width:480px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2013.png"/></a></figure></details></li></ul><ul id="b9fd813b-ef5a-4550-a0c4-ceea7aa2ccb8" class="bulleted-list"><li style="list-style-type:disc">Tick the <code>Require authorization</code> checkbox to only allow authorized clients to invalidate the cache.</li></ul></div><div id="94854046-6477-4bc3-ba0d-83fa69f169c3" style="width:37.50000000000001%" class="column"><figure id="8ce04cfa-13f8-40b5-a4c2-bbfd653606c9" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2014.png"><img style="width:656px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2014.png"/></a></figure></div></div><h2 id="3547d3bf-661b-49fa-8100-053f8efa76d9" class=""> Usage Plans</h2><ul id="5d0f1938-83f8-4449-bb17-3000900d56df" class="bulleted-list"><li style="list-style-type:disc">Used to monetize the APIs<ul id="23b4fca0-67d2-487d-8fd3-2194549e3583" class="bulleted-list"><li style="list-style-type:circle">Which clients can access what stages and methods</li></ul><ul id="fbb62f39-4dc0-45de-93cd-56736a30b3ab" class="bulleted-list"><li style="list-style-type:circle">Throttling and quota limits for each client</li></ul></li></ul><ul id="1bf7d7f4-b3f0-41ef-8c44-72b31d1bf020" class="bulleted-list"><li style="list-style-type:disc">Clients use API keys to access the APIs (passed in <code>X-API-Key</code> header)</li></ul><ul id="27fa9788-de67-411c-8c70-8a2dd6edef26" class="bulleted-list"><li style="list-style-type:disc">Throttling limits are applied for each API key</li></ul><ul id="bf5948c4-c4bd-4847-b606-21517243b342" class="bulleted-list"><li style="list-style-type:disc">Clients are billed based on the API calls using their API keys</li></ul><h3 id="aebf7200-8602-4f9a-9455-bd7080163255" class="">Steps to setup a Usage Plan</h3><ul id="4d72c54d-8bc9-442f-a004-8b16158edabe" class="bulleted-list"><li style="list-style-type:disc">Create the API and deploy them to the right stages</li></ul><ul id="0aa4f81b-3687-4f9d-91b1-640da9d75563" class="bulleted-list"><li style="list-style-type:disc">Generate API keys and distribute them to the customers</li></ul><ul id="08c5ac1e-d2a2-42e9-8177-6cbef88e86ba" class="bulleted-list"><li style="list-style-type:disc">Create a usage plan with the desired throttle and quota limits</li></ul><ul id="1f954225-810c-4b08-a7b3-9d25615882b3" class="bulleted-list"><li style="list-style-type:disc"><strong>Associate</strong> API stages and <strong>API keys with the usage plan</strong> using <code>CreateUsagePlanKey</code> API</li></ul><h2 id="51d508cb-19a4-484b-a7d1-866329457979" class="">Observability</h2><h3 id="622af6f1-e784-437a-a6a0-5a3ca73cdac3" class="">Logging</h3><ul id="1b0ce089-1f2e-4612-ad73-4572492e4a6f" class="bulleted-list"><li style="list-style-type:disc">Logs contain the request and response passing through API gateway</li></ul><ul id="e3746254-9ac8-4346-ba85-a4508f34d901" class="bulleted-list"><li style="list-style-type:disc"><strong>Can be enabled at the stage level</strong></li></ul><ul id="557e9166-9ed2-4ab4-9e39-db726bcc45de" class="bulleted-list"><li style="list-style-type:disc">Can override the logging settings at the API level</li></ul><ul id="578e889a-8028-456d-b759-5a5ffc5a6654" class="bulleted-list"><li style="list-style-type:disc">Sent to CloudWatch logs (set Log Level: <code>ERROR</code>, <code>DEBUG</code>, <code>INFO</code>)</li></ul><ul id="106f1580-1714-43a2-9f14-96949820dfd9" class="bulleted-list"><li style="list-style-type:disc">Two types of logs:<ul id="047c5f33-04da-43d6-b243-2e8bd790a100" class="bulleted-list"><li style="list-style-type:circle"><strong>Execution Logs</strong>: log requests, responses, etc.</li></ul><ul id="3a477585-e34b-4fe3-ae30-190900954e59" class="bulleted-list"><li style="list-style-type:circle"><strong>Access Logs</strong>: who accessed the API and how</li></ul></li></ul><h3 id="6ac080e4-de36-434b-897c-40362fae784b" class="">Tracing</h3><ul id="d57dbe0b-4268-40dd-add0-34efa720d868" class="bulleted-list"><li style="list-style-type:disc">Enable X-Ray to trace API calls</li></ul><h3 id="b7673231-8e0b-4e72-9e91-7b237976c472" class="">Metrics</h3><ul id="417fd7a4-2681-4941-8192-49eca018c0a9" class="bulleted-list"><li style="list-style-type:disc">Metrics are available at the stage level</li></ul><ul id="fad138a9-75ab-4420-9572-a6fdeeb56a21" class="bulleted-list"><li style="list-style-type:disc">Can enable detailed metrics</li></ul><ul id="32e0a3fc-4225-4024-890e-866b7dddd491" class="bulleted-list"><li style="list-style-type:disc">Key metrics:<ul id="ba6315cd-0d47-4cf5-9d7f-85d61cec6ce4" class="bulleted-list"><li style="list-style-type:circle"><code>CacheHitCount</code> &amp; <code>CacheMissCount</code></li></ul><ul id="891915e0-eb08-46a8-848a-7593c0ffe951" class="bulleted-list"><li style="list-style-type:circle"><code>Count</code> - request count within a period</li></ul><ul id="0d2a662b-1591-42d9-82f5-2e4ae2de0334" class="bulleted-list"><li style="list-style-type:circle"><code>IntegrationLatency</code> - how long the backend takes to reply to the API gateway</li></ul><ul id="9465ea67-5d8b-4a6a-870c-e5fb573a8d69" class="bulleted-list"><li style="list-style-type:circle"><code>Latency</code> - how long client had to wait to get a response from API gateway (includes integration latency and other API Gateway overheads such as authorization)</li></ul><ul id="14545329-d6ff-4e6d-9366-5284dac306b0" class="bulleted-list"><li style="list-style-type:circle"><code>4XXError</code> - client side error count</li></ul><ul id="96ca49e7-c9c1-4cf9-836b-3867981a1c63" class="bulleted-list"><li style="list-style-type:circle"><code>5XXError</code> - server sider error count</li></ul></li></ul><h2 id="33da31e3-ff23-42b5-8737-d2abf358c3f5" class="">Performance</h2><ul id="f93b5cae-93dd-460f-8c28-989ebf98e2fe" class="bulleted-list"><li style="list-style-type:disc"><strong>Max timeout: 29 sec</strong></li></ul><ul id="8417ef04-1c71-48a4-9d6f-4f2cbeccfce7" class="bulleted-list"><li style="list-style-type:disc">Throttling limit - 10,000 req/sec across all APIs (account level soft limit)<ul id="464386c0-7477-4118-b1db-5b6e7cfa54e2" class="bulleted-list"><li style="list-style-type:circle"><code>429 Too Many Requests</code> error in case of throttling</li></ul><ul id="c16c977b-7caa-44dd-a0cc-ede8011eb34b" class="bulleted-list"><li style="list-style-type:circle">If one API is getting too many requests, it can throttle other APIs</li></ul><ul id="8042051a-c599-4a5b-89fc-658c71943c02" class="bulleted-list"><li style="list-style-type:circle"><mark class="highlight-yellow_background">Set stage limits or method limits to prevent overuse</mark></li></ul><ul id="bb6f2635-3d16-44a5-b851-4696f869b101" class="bulleted-list"><li style="list-style-type:circle">Create a usage plan to throttle per customer</li></ul></li></ul><h2 id="e7b07926-841f-4ac5-888a-1ee41d3e324c" class="">Cross Origin Resource Sharing (CORS)</h2><ul id="babd240f-61a5-4271-8090-8a2f9c9014cc" class="bulleted-list"><li style="list-style-type:disc">Enable if you will receive API calls from another domain</li></ul><ul id="d9b44d15-83a8-4569-a43e-fc0bc1c8b778" class="bulleted-list"><li style="list-style-type:disc">The response of pre-flight request must contain <code>Access-Control-Allow-Origin</code> header to allow the cross-origin client to make API calls.</li></ul><ul id="e9c5b56f-9e3f-4ddb-9a4a-4a6652cae6dc" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-yellow_background">When the integration type is proxy-based</mark>, the responses are proxied to the client without modification by API gateway. So, <mark class="highlight-yellow_background">CORS needs to be handled by the backend itself.</mark> </li></ul><ul id="ceb37b03-6078-4e53-92fc-250bad6e9fde" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-yellow_background">For non-proxy integrations, CORS can be handled by API gateway.</mark></li></ul><ul id="9507eeae-9739-417d-924f-0db56366b2ee" class="bulleted-list"><li style="list-style-type:disc"><code>MaxAgeSeconds</code> specifies the TTL used by browser to cache pre-flight response</li></ul><ul id="1834216c-4143-4646-888c-052e252d6012" class="bulleted-list"><li style="list-style-type:disc">The client-side JS in the website (<code>www.example.com</code>) wants to make an API call to the backend hosted via API gateway at <code>api.example.com</code>. The browser will first make a pre-flight request to the backend asking what methods are allowed for <code>www.example.com</code>. If CORS is enabled, API gateway will allow the required methods.<figure id="7dbf34c7-09a1-46cc-a5b1-e791591f05c2" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2015.png"><img style="width:1808px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2015.png"/></a></figure></li></ul><h2 id="90d9b2a1-916a-4c97-8429-f816eaf5cc9e" class="">TLS Termination</h2><ul id="400a2dcb-1a02-4679-bea8-06b6e8adfd2d" class="bulleted-list"><li style="list-style-type:disc">TLS certificates can be referenced from ACM</li></ul><ul id="4d4833ba-0b20-4752-859a-6df0e9ed5579" class="bulleted-list"><li style="list-style-type:disc">Edge-Optimized endpoint → certificate must be in <code>us-east-1</code></li></ul><ul id="d3f0d131-58e1-41b7-9267-8d9160059509" class="bulleted-list"><li style="list-style-type:disc">Regional endpoint → certificate must be in the same region as API Gateway</li></ul><ul id="326ec5ed-de40-4522-a5c0-7fae45f76a9a" class="bulleted-list"><li style="list-style-type:disc">Must setup CNAME or A-alias record in Route 53 to point to the API gateway endpoint</li></ul><h2 id="92f4174b-c8bf-4e3f-ab71-3140f19df876" class="">User Authentication</h2><h3 id="39597bd3-127b-4e76-b0ef-0ba46c83bd72" class="">IAM</h3><figure id="9ea003b7-b8c3-4d67-981f-ad00fd9ed34e" class="image" style="text-align:left"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2016.png"><img style="width:480px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2016.png"/></a></figure><ul id="caabd998-d244-4047-981a-d31f075ee1e7" class="bulleted-list"><li style="list-style-type:disc">IAM User or Role for authentication</li></ul><ul id="cb2ec15c-4cfc-4abd-8ba3-68512483786f" class="bulleted-list"><li style="list-style-type:disc">IAM Policy applied to principals for authorization (access control)</li></ul><ul id="c5971035-cfc6-424d-9e4e-becb086f66ca" class="bulleted-list"><li style="list-style-type:disc">Fully integrated with API gateway (no custom implementation needed)</li></ul><ul id="476fd49a-e882-4bbb-af4a-1ad2394a935b" class="bulleted-list"><li style="list-style-type:disc">Good to provide access within AWS</li></ul><ul id="0121a961-82e6-43af-946a-9579ae8a4acc" class="bulleted-list"><li style="list-style-type:disc">Leverages <strong>SigV4</strong> to sign the credentials in the header</li></ul><ul id="8ddc8831-64a5-4f6c-9b98-cca409367afb" class="bulleted-list"><li style="list-style-type:disc"><strong>Resource-based policies</strong> can be used to allow the following access to API gateway<ul id="18012d9a-bff7-4bb0-9576-05209eff7817" class="bulleted-list"><li style="list-style-type:circle">IAM Users and Roles in another account (cross-account access)</li></ul><ul id="f11afcba-55ea-4613-86c7-f4c2689e92c7" class="bulleted-list"><li style="list-style-type:circle">IP Addresses</li></ul><ul id="74627c86-e60b-43a7-8f63-5fb6f1739d25" class="bulleted-list"><li style="list-style-type:circle">VPC Endpoint</li></ul></li></ul><h3 id="98ac2b6c-cb58-459f-90f3-f8357cbf74f2" class="">Cognito User Pools (CUP)</h3><figure id="7f4fe7a5-93c6-45f5-889a-ab6c406cb839" class="image" style="text-align:left"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2017.png"><img style="width:528px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2017.png"/></a></figure><p id="6a754f8c-3682-45d4-a507-3c0e32d7b7fa" class="">The client first authenticates themselves to CUP and get the token. They pass the token along with the request to API gateway. API gateway verifies the token with Cognito before forwarding the request to the backend.</p><ul id="af2e0b23-917a-4ced-9500-bbcc107ddf0d" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-yellow_background">Cognito is AWS managed identity provider.</mark> It fully manages user lifecycle and <mark class="highlight-yellow_background">expires tokens automatically</mark>.</li></ul><ul id="fd22b802-b540-44e3-99ae-313dfdef5755" class="bulleted-list"><li style="list-style-type:disc">Fully integrated with API gateway (no custom implementation needed)</li></ul><ul id="e8bca322-415e-4a81-9d85-d8443436f007" class="bulleted-list"><li style="list-style-type:disc"><strong>Only provides authentication</strong> (access to the API) <mark class="highlight-yellow_background">(authorization needs to be managed in the backend)</mark></li></ul><ul id="288d9ecb-0732-4642-b2f3-94d3bd0125f1" class="bulleted-list"><li style="list-style-type:disc">Good to provide access to external users</li></ul><h3 id="5c835444-18fc-4d24-9798-35926c2e9c94" class="">Lambda Authorizer</h3><figure id="1ea164f5-3275-4647-8ca7-4d149f833370" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2018.png"><img style="width:720px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2018.png"/></a></figure><p id="1aa97722-6361-4b10-a0b4-1d0584fa427f" class="">The client authenticates themselves to a 3rd party IDP and retrieve the token. The token is passed along with the request to the API gateway. <mark class="highlight-yellow_background">The lambda authorizer takes the token, decodes it and determines the required IAM permissions.</mark> It can optionally verify the token with the IDP. <mark class="highlight-yellow_background">The lambda authorizer then creates an IAM principal and policy granting the required permissions.</mark></p><ul id="2e79f277-af80-40f2-bd80-9a53419f8dc3" class="bulleted-list"><li style="list-style-type:disc">Custom authorization logic (manual integration)</li></ul><ul id="af155f41-8c1d-41c4-b1e1-6e1236d87ac4" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-yellow_background">Authentication is handled externally</mark></li></ul><ul id="e570af5a-3255-47cf-8228-049b739e3173" class="bulleted-list"><li style="list-style-type:disc">Authorization is performed by the lambda function</li></ul><ul id="b2e40035-67e5-40c5-881e-828d9e62d24b" class="bulleted-list"><li style="list-style-type:disc">Enable caching the result of authorization (recommended)</li></ul><ul id="572737b5-575a-490c-9cbd-cab35ac88383" class="bulleted-list"><li style="list-style-type:disc">Recommended to use this and not just rely on API keys for enhanced security.</li></ul><ul id="713b1913-f009-4b5b-bf6c-3c1ffb7d96e6" class="bulleted-list"><li style="list-style-type:disc">Two types:<ul id="b95dfdf1-9107-43b8-ad8b-66b9a4db21ce" class="bulleted-list"><li style="list-style-type:circle"><strong>Token-based Lambda authorizer</strong> (Token Authorizer) uses JWT or OAuth <strong>for 3rd party authentication system</strong></li></ul><ul id="9b0ef142-a259-492e-a6fe-2c04afce7b12" class="bulleted-list"><li style="list-style-type:circle"><strong>Request parameter-based Lambda authorizer</strong> (Request Authorizer) receives the caller&#x27;s identity in a combination of headers, query string parameters, stageVariables, and <code>$context</code> variables.</li></ul></li></ul><h2 id="72cb7920-13c9-4a56-83a1-b1266e39d17e" class="">API Types</h2><h3 id="0ad96b96-a690-4927-a529-a9636e26e8c9" class=""><strong>REST</strong></h3><ul id="2aa05353-a7e9-42a2-9206-bc31322a39f0" class="bulleted-list"><li style="list-style-type:disc">Standard APIs that we mostly create</li></ul><ul id="c14063a2-0528-427c-af89-e1be8af7f3a8" class="bulleted-list"><li style="list-style-type:disc">Supports resource-based policy</li></ul><ul id="25b5bf09-e960-4965-9432-e491cc31e3cd" class="bulleted-list"><li style="list-style-type:disc"><strong>Does not support OIDC and OAuth 2.0 natively</strong></li></ul><h3 id="3f9c2c9d-ab9d-42eb-b2ad-87451ec95163" class=""><strong>HTTP</strong></h3><ul id="efd38a7c-d9df-4aab-9817-9210f7186531" class="bulleted-list"><li style="list-style-type:disc"><strong>Low-latency</strong> &amp; cost effective <strong>proxies</strong> to Lambda or any HTTP endpoint (no data mapping)</li></ul><ul id="1f55c771-43ce-4430-8b63-f5e60d956f34" class="bulleted-list"><li style="list-style-type:disc">Supports OIDC and OAuth 2.0</li></ul><ul id="43b39e3b-31ad-47ff-a34f-c9e292862409" class="bulleted-list"><li style="list-style-type:disc">No usage plans and API keys</li></ul><ul id="6c00d84c-a24d-4fdc-88a7-ddaaaf733bb6" class="bulleted-list"><li style="list-style-type:disc">Does not support resource-based policies</li></ul><ul id="bc61156b-13d3-4a64-abb4-2607df589eae" class="bulleted-list"><li style="list-style-type:disc"><strong>Cheaper than REST APIs</strong></li></ul><h3 id="8946b2f7-6edf-408c-abe9-f8322d975349" class=""><strong>WebSocket</strong></h3><ul id="6e508df6-1dca-43c1-bab6-841f9be5adf9" class="bulleted-list"><li style="list-style-type:disc">2 - way communication between the client and the server</li></ul><ul id="67940acd-5bb2-40c9-bb56-154f87a2833d" class="bulleted-list"><li style="list-style-type:disc">Connection is persistent and stateful</li></ul><ul id="82ddcbfe-4af6-460a-b12f-46515b53f60d" class="bulleted-list"><li style="list-style-type:disc">Used in real-time chat application, collaboration platforms, multiplayer games and financial trading platforms.</li></ul><ul id="6a09d287-0eda-4f73-9935-6ec28e9e7452" class="bulleted-list"><li style="list-style-type:disc">The backend can be anything (AWS services or any HTTP endpoint)</li></ul><ul id="0fa27b0d-5368-4960-8d8e-61e487354d89" class="toggle"><li><details open=""><summary>Establishing a WebSocket Connection</summary><p id="dd102203-8c50-42ea-9789-430283b66f1b" class="">The client sends a request to the WebSocket url (<code>wss://[some-uniqueid].execute-api.[region].amazonaws.com/[stage-name]</code>) of API gateway. This establishes a persistent connection between the client and the API gateway. The API gateway calls a Lambda function (<code>onConnect</code>) and passes the connectionId which is then stored in DynamoDB (stateful).</p><figure id="185c73cf-761b-453d-bf65-838f32504908" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2019.png"><img style="width:1666px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2019.png"/></a></figure></details></li></ul><ul id="c5b5e0ea-627f-4095-94c7-768109d1c37a" class="toggle"><li><details open=""><summary>Client → Server Messaging</summary><p id="0d79a688-b9a0-43d0-83fb-8ff8213993ca" class="">Once the WebSocket connection is established, the client can keep on sending messages (frames) to the server on the same WebSocket URL through the same persistent connection. The sent frames will invoke another lambda function to perform the desired action.</p><figure id="8b0786d8-761e-47d5-bf22-61957e44be18" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2020.png"><img style="width:1704px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2020.png"/></a></figure></details></li></ul><ul id="55bb63af-10ab-4168-b506-4eb082b5f8a9" class="toggle"><li><details open=""><summary>Server → Client Messaging</summary><p id="bace7382-f7fe-4afc-8eea-124acda08a1d" class="">A lambda function can make an HTTP POST request (signed by SigV4) to the <strong>Connection URL</strong> (WebSocket URL + <code>/@connections/[connectionId]</code>) to <mark class="highlight-yellow_background">send messages to the client through the API gateway</mark>.</p><figure id="c1c3fb95-6250-4a43-a488-7b239292f05d" class="image"><a href="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2021.png"><img style="width:1678px" src="API%20Gateway%20c14b044b44f845198432c631cb04de2a/Untitled%2021.png"/></a></figure></details></li></ul><ul id="7c03fc14-8353-4c58-9915-c1e071bce8bc" class="bulleted-list"><li style="list-style-type:disc">Operations on WebSocket Connection URL (WebSocket URL + <code>/@connections/[connectionId]</code>)<ul id="ebb01063-9b4f-4ed0-9180-5d36d8b4e941" class="bulleted-list"><li style="list-style-type:circle"><code>POST</code> - Send a message from the Server to the connected WS Client</li></ul><ul id="e3c5a094-1441-4017-8e12-d7006365e651" class="bulleted-list"><li style="list-style-type:circle"><code>GET</code> - Get the latest connection status of the connected WS Client</li></ul><ul id="96f420ba-4673-4382-8d17-3b13801a6553" class="bulleted-list"><li style="list-style-type:circle"><code>DELETE</code> - Disconnect the connected Client from the WS connection</li></ul></li></ul><ul id="31368b3f-bef6-40fc-8123-224e328683be" class="bulleted-list"><li style="list-style-type:disc"><strong>Routing</strong>: Incoming JSON messages from the client are routed to different backend based on the <strong>Route Key Table</strong> (defined in API gateway). We can specify route selection expression to route based on a field in the JSON message. If no match, it is sent to the <code>$default</code> route.</li></ul><p id="6eca29cf-feb8-4013-bf93-0cf8d823fc60" class="">
</p></div></article></body></html>