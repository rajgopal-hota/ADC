<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>VPC</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-interactiveBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="52853e01-7ca0-4f19-a83d-64ee8663575f" class="page sans"><header><h1 class="page-title">VPC</h1><p class="page-description"></p></header><div class="page-body"><nav id="7e128d8e-5cb9-4cde-af4b-41e8d349b920" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#65c2af97-c1dd-4362-9571-2457c6779158">Intro</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#1c969636-2d7f-4a84-8ab4-3485e5af01c1">Subnets</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#19c0458a-1659-4460-8734-627cca9e5f2f">Internet Gateway (IGW)</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#08bee590-1fd3-49e9-8a7e-808158f62b1b">Network Address Translation (NAT) Instance</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#bb127910-0a3b-4acb-84a3-a101a71db0a5"><strong>Disadvantages</strong></a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#af2c8d2e-27fd-4d30-8ac8-1dd96adbc7aa">NAT Gateway</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#00af47cb-913b-4e37-8dd7-bd0211df7889">High Availability</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#883d6b9c-10e2-4181-8f28-52f5d03936f9">Network Access Control List (NACL)</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#fdda55c3-fdc8-449b-b36d-ff2d1196ff6a">NACL vs Security Group</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#4c16e8a3-eb03-4b90-8fa4-da6383f49e7f">VPC Peering</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#20322a81-c483-41cb-b875-32d756ecc171">VPC Endpoints</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#004afca1-d171-4a21-8ddd-0baf2efc25fd">VPC Flow Logs</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#3e96cc90-cc61-44f9-b02e-e35cf286da39">Connecting to On-Premise</a></div></nav><hr id="fbb37f3f-f738-4259-a37e-8f5b54b85907"/><h2 id="65c2af97-c1dd-4362-9571-2457c6779158" class="">Intro</h2><ul id="9fc7b81c-7058-4da4-89d3-6db180f0c9ee" class="bulleted-list"><li style="list-style-type:disc"><strong>Regional resource</strong></li></ul><ul id="921a707c-c1c5-49a9-9557-f2274ce5e1b4" class="bulleted-list"><li style="list-style-type:disc">Soft limit of 5 VPCs per region</li></ul><ul id="97fd6232-d2d0-4a7e-8638-0f8349b0806d" class="bulleted-list"><li style="list-style-type:disc">Only the Private IPv4 ranges are allowed</li></ul><h2 id="1c969636-2d7f-4a84-8ab4-3485e5af01c1" class="">Subnets</h2><ul id="e890b4a1-448f-46ca-a1c2-11d7b4626fa2" class="bulleted-list"><li style="list-style-type:disc">Sub-ranges of IP addresses within the VPC</li></ul><ul id="ecec1ee9-2b44-4f02-adc5-75c6f7766fb2" class="bulleted-list"><li style="list-style-type:disc"><strong>Each subnet is bound to an AZ</strong></li></ul><ul id="77b18eb6-10e4-4554-9364-a68c8bffa598" class="bulleted-list"><li style="list-style-type:disc">Subnets in a VPC cannot have overlapping CIDRs</li></ul><ul id="455e9149-3a29-4ee7-9f16-67ace7f27f03" class="bulleted-list"><li style="list-style-type:disc"><strong>Default VPC only has public subnets</strong> (1 public subnet per AZ, no private subnet)</li></ul><ul id="f8a672bc-0496-466f-8cd9-76ed2dd80bb8" class="bulleted-list"><li style="list-style-type:disc"><strong>AWS reserves 5 IP addresses (first 4 &amp; last 1) in each subnet</strong>. These 5 IP addresses are not available for use.
Example: if CIDR block 10.0.0.0/24, then reserved IP addresses are 10.0.0.0, 10.0.0.1, 10.0.0.2, 10.0.0.3 &amp; 10.0.0.255</li></ul><figure class="block-color-teal_background callout" style="white-space:pre-wrap;display:flex" id="89ccaeae-bf79-4ac5-ab26-1a67df5185d2"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">To make the EC2 instances running in private subnets accessible on the internet, place them behind an internet-facing (running in public subnets) Elastic Load Balancer.</div></figure><figure class="block-color-teal_background callout" style="white-space:pre-wrap;display:flex" id="3109fe82-d24b-4ee7-b5f4-2c941be7045f"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">There is no concept of Public and Private subnets. Public subnets are subnets that have:<ul id="9b95e53e-1d4c-4768-a34e-9ad99526802f" class="bulleted-list"><li style="list-style-type:disc">“Auto-assign public IPv4 address” set to “Yes”</li></ul><ul id="57bd15d9-6e26-4770-a190-87e204a98b39" class="bulleted-list"><li style="list-style-type:disc">The subnet route table has an attached Internet Gateway</li></ul><p id="1a7e55ab-3b59-42b2-9c16-0942b9869bc1" class="">This allows the resources within the subnet to make requests that go to the public internet. <strong>A subnet is private by default.</strong></p><p id="0d5bea60-4030-48bc-be99-8d68aa479fb7" class="">Since the resources in a private subnet don&#x27;t have public IPs, they need a NAT gateway for address translation to be able to make requests that go to the public internet. NAT gateway also prevents these private resources from being accessed from the internet.</p></div></figure><h2 id="19c0458a-1659-4460-8734-627cca9e5f2f" class="">Internet Gateway (IGW)</h2><figure id="91ac46f5-3b42-43a7-b9e0-682e9f4d6ae4" class="image"><a href="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled.png"><img style="width:720px" src="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled.png"/></a></figure><ul id="9d68a57b-7685-43b8-9c4d-a503ff894e7d" class="bulleted-list"><li style="list-style-type:disc">Allows resources in a VPC to connect to the Internet</li></ul><ul id="a198628e-32f8-4b20-8eac-34886637f0c4" class="bulleted-list"><li style="list-style-type:disc"><strong>Attached to the VPC </strong>(not subnets)</li></ul><ul id="5c5ac666-98a3-4065-aeb4-adca7ba5240c" class="bulleted-list"><li style="list-style-type:disc">Should be used to <strong>connect public resources to the internet</strong> (use NAT gateway for private resources since they need network address translation)</li></ul><ul id="6bc22c63-05e6-4a9b-807a-5d612581838c" class="toggle"><li><details open=""><summary>Route table of the public subnets must be edited to allow requests destined outside the VPC to be routed to the IGW</summary><figure id="d3c15853-f351-4e55-9b8c-3b86e6a18d91" class="image"><a href="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%201.png"><img style="width:1862px" src="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%201.png"/></a></figure></details></li></ul><figure class="block-color-teal_background callout" style="white-space:pre-wrap;display:flex" id="694da6a1-3ce5-43fc-9a11-33de03aa8b35"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%">IGW performs network address translation (NAT) for a public EC2 instance</div></figure><h2 id="08bee590-1fd3-49e9-8a7e-808158f62b1b" class="">Network Address Translation (NAT) Instance</h2><figure id="b1068760-daa7-4077-8280-b5d3b45d06e8" class="image"><a href="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%202.png"><img style="width:1528px" src="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%202.png"/></a></figure><div id="48021f38-cdef-407a-9b99-b25b103eeb55" class="column-list"><div id="93ab1f1f-0cfa-41fc-9671-1a7c39c40592" style="width:50%" class="column"><ul id="63d54fbe-c681-4d65-bbe4-1dbcb457120f" class="bulleted-list"><li style="list-style-type:disc">An EC2 instance <strong>launched in the public subnet</strong> which performs network address translation to enable private instances to use the public IP of the NAT instance to access the internet. This is exactly the same as how routers perform NAT. This also prevents the private instances from being accessed from the public internet.</li></ul><ul id="9b0e20d2-7fc2-44d5-8c24-bc0a4e7aa3a8" class="bulleted-list"><li style="list-style-type:disc"><strong>Must disable EC2 setting: source / destination IP check on the NAT instance</strong> as the IPs can change.</li></ul><ul id="4165841e-6e35-4482-83f5-992ef4d4edb8" class="bulleted-list"><li style="list-style-type:disc"><strong>Must have an Elastic IP attached to it</strong></li></ul><ul id="ee6b7a48-2cdb-4f43-86ff-5495f37b887d" class="bulleted-list"><li style="list-style-type:disc">Route Tables for private subnets must be configured to route internet-destined traffic to the NAT instance (its elastic IP)</li></ul><ul id="1d597406-de80-4033-98ca-4a760b38ab94" class="bulleted-list"><li style="list-style-type:disc"><strong>Can be used as a Bastion Host</strong></li></ul></div><div id="e241e8a3-f23d-4e5a-9655-f364e7c97399" style="width:50%" class="column"><figure id="826a9563-5547-41dd-9dbd-c34e4994d3a9" class="image"><a href="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%203.png"><img style="width:634px" src="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%203.png"/></a></figure></div></div><h3 id="bb127910-0a3b-4acb-84a3-a101a71db0a5" class=""><strong>Disadvantages</strong></h3><ul id="7e424e0e-93c2-4839-9da2-8e32f569b8e2" class="bulleted-list"><li style="list-style-type:disc">Not highly available or resilient out of the box. Need to create an ASG in multi-AZ + resilient user-data script</li></ul><ul id="f9f4a8f5-85e5-4705-9080-f671b335a5a5" class="bulleted-list"><li style="list-style-type:disc">Internet traffic bandwidth depends on EC2 instance type</li></ul><ul id="6cb09e17-8b25-45c4-88e7-4cf77c42b310" class="bulleted-list"><li style="list-style-type:disc">You must manage Security Groups &amp; rules:<ul id="9c8f76a7-85da-4bbb-bde8-ba7e99cbd3cb" class="bulleted-list"><li style="list-style-type:circle">Inbound:<ul id="4131d217-70c6-4077-a34b-401f47ddb70a" class="bulleted-list"><li style="list-style-type:square">Allow HTTP / HTTPS traffic coming from Private Subnets</li></ul><ul id="973678fa-e1ac-4d3e-9bb4-32e8fa838461" class="bulleted-list"><li style="list-style-type:square">Allow SSH from your home network (access is provided through Internet Gateway)</li></ul></li></ul><ul id="ebb98ddc-5585-4ade-af3c-dde0bebf6105" class="bulleted-list"><li style="list-style-type:circle">Outbound:<ul id="a785df97-d451-40ba-9f5a-c101937e7e07" class="bulleted-list"><li style="list-style-type:square">Allow HTTP / HTTPS traffic to the Internet</li></ul></li></ul></li></ul><h2 id="af2c8d2e-27fd-4d30-8ac8-1dd96adbc7aa" class="">NAT Gateway</h2><figure id="90b7cc54-3760-4335-b32b-20dc6211d289" class="image"><a href="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%204.png"><img style="width:1530px" src="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%204.png"/></a></figure><ul id="ec1f46df-7fa6-4d95-a241-4607ae1ae79c" class="bulleted-list"><li style="list-style-type:disc">AWS managed NAT with <strong>bandwidth autoscaling</strong> (up to 45Gbps)</li></ul><ul id="85145630-46a2-494e-a599-6426c3230034" class="bulleted-list"><li style="list-style-type:disc">Preferred over NAT instances</li></ul><ul id="72e58409-27a0-401f-8b85-dc0928ea17ec" class="bulleted-list"><li style="list-style-type:disc"><strong>Uses an Elastic IP</strong> and Internet Gateway behind the scenes</li></ul><ul id="b681ca4b-6eb0-4f62-a5fa-a33f1130f603" class="bulleted-list"><li style="list-style-type:disc"><strong>Created in a public subnet</strong></li></ul><ul id="9d184c44-289c-4329-b779-c89c46755439" class="bulleted-list"><li style="list-style-type:disc"><strong>Bound to an AZ</strong></li></ul><ul id="37179345-14ff-4193-81bd-9c171d09b016" class="bulleted-list"><li style="list-style-type:disc"><strong>Cannot be used by EC2 instances in the same subnet</strong> (only from other subnets)</li></ul><ul id="468aa539-d408-4bc0-8690-de586c306c9e" class="bulleted-list"><li style="list-style-type:disc"><strong>Cannot be used as a Bastion Host</strong></li></ul><ul id="a920ca83-a5e6-4634-9663-4174d95df9f9" class="toggle"><li><details open=""><summary>Route Tables for private subnets must be configured to route internet-destined traffic to the NAT gateway</summary><figure id="9e6c2f2d-abc8-4a79-a3a3-2097e0a10104" class="image"><a href="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%205.png"><img style="width:1058px" src="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%205.png"/></a></figure></details></li></ul><ul id="c0652a1e-cec7-4e30-b2be-41315330654b" class="bulleted-list"><li style="list-style-type:disc">No Security Groups to manage</li></ul><ul id="88ef492a-07d8-42d3-b54a-549122b1ca40" class="bulleted-list"><li style="list-style-type:disc">Pay per hour</li></ul><h3 id="00af47cb-913b-4e37-8dd7-bd0211df7889" class="">High Availability</h3><div id="e0ec2ea2-61da-4a79-b39c-d8014efa14c3" class="column-list"><div id="cb0e6ba3-691d-4ad7-aa1c-d9eaa4763a59" style="width:37.5%" class="column"><ul id="612282ef-7b56-4f62-b650-2ab638323ea4" class="bulleted-list"><li style="list-style-type:disc">Create NAT gateways in public subnets bound to different AZ all routing outbound connections to the IGW (attached to the VPC)</li></ul><ul id="4349a53d-f67e-4f2e-ad11-6b198b68bdf1" class="bulleted-list"><li style="list-style-type:disc">No cross-AZ failover needed because if an AZ goes down, all of the instances in that AZ also go down.</li></ul><p id="1f3e074c-e7a8-4b3c-80a0-aa5aca579be3" class="">
</p></div><div id="cd49d724-3310-41d4-95e2-094f91e595a5" style="width:62.5%" class="column"><figure id="40c02fde-a372-42e6-b742-740668c2bfde" class="image"><a href="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%206.png"><img style="width:890px" src="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%206.png"/></a></figure></div></div><h2 id="883d6b9c-10e2-4181-8f28-52f5d03936f9" class="">Network Access Control List (NACL)</h2><ul id="34186087-9206-4072-ac26-dfb35ec21ad9" class="bulleted-list"><li style="list-style-type:disc">NACL is a firewall at the subnet level</li></ul><ul id="8ad1bad8-d7ba-4b22-be67-3f619bb8c6a0" class="bulleted-list"><li style="list-style-type:disc">One NACL per subnet but a NACL can be attached to multiple subnets</li></ul><ul id="9c2a7be4-484c-492a-87fd-163910bffbb0" class="bulleted-list"><li style="list-style-type:disc"><strong>New subnets are assigned the Default NACL</strong></li></ul><ul id="20111433-19fb-4c90-9b3e-60f278c7a4e7" class="toggle"><li><details open=""><summary><strong>Default NACL allows all inbound &amp; outbound requests</strong></summary><figure id="a9a99cef-e4f4-4bef-b03a-e1e4043672c3" class="image"><a href="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%207.png"><img style="width:528px" src="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%207.png"/></a></figure></details></li></ul><ul id="61f9f7a1-d1e0-48bd-b5fb-d5e9fa27b0c3" class="bulleted-list"><li style="list-style-type:disc">NACL Rules<ul id="644db4a4-83f3-4b29-8d41-7dcdd1e5d0bf" class="bulleted-list"><li style="list-style-type:circle">Based only on IP addresses</li></ul><ul id="9af4f210-da33-49c9-b59c-54e9930e31a7" class="bulleted-list"><li style="list-style-type:circle">Rules number: 1-32766 (lower number has higher precedence)</li></ul><ul id="ce8f2d03-cf67-496d-a710-3b82c704f7a2" class="bulleted-list"><li style="list-style-type:circle">First rule match will drive the decision</li></ul><ul id="5d1181d3-0f99-41c7-9093-22925ab485f6" class="bulleted-list"><li style="list-style-type:circle">The last rule denies the request (only when no previous rule matches)</li></ul></li></ul><h3 id="fdda55c3-fdc8-449b-b36d-ff2d1196ff6a" class="">NACL vs Security Group</h3><figure id="32cbc833-0998-4497-a91f-e223542de045" class="image"><a href="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%208.png"><img style="width:1748px" src="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%208.png"/></a></figure><table id="299039d8-f51e-49cf-b647-9a814124db66" class="simple-table"><thead class="simple-table-header"><tr id="95c61ece-1949-48f8-8ccb-85dbf8d790dc"><th id="NRQ_" class="simple-table-header-color simple-table-header" style="width:349px">Security Group</th><th id="D=]&gt;" class="simple-table-header-color simple-table-header" style="width:349px">NACL</th></tr></thead><tbody><tr id="1f0536e4-4401-4dec-9747-124e68fa1c2d"><td id="NRQ_" class="" style="width:349px">Firewall for EC2 (applied to ENI)</td><td id="D=]&gt;" class="" style="width:349px">Firewall for subnets</td></tr><tr id="98ac754c-c55d-4569-9ff8-c67db3dc797e"><td id="NRQ_" class="" style="width:349px">Supports only Allow rules</td><td id="D=]&gt;" class="" style="width:349px">Supports both Allow and Deny rules</td></tr><tr id="2fb32fce-830c-4763-8588-fa835261ce68"><td id="NRQ_" class="" style="width:349px">Stateful (only request will be evaluated against the SG rules)</td><td id="D=]&gt;" class="" style="width:349px">Stateless (both request and response will be evaluated against the NACL rules)</td></tr><tr id="f050790b-c823-48c1-ad4e-66d81b90d082"><td id="NRQ_" class="" style="width:349px">All rules are evaluated</td><td id="D=]&gt;" class="" style="width:349px">Only the first matched rule is considered</td></tr></tbody></table><h2 id="4c16e8a3-eb03-4b90-8fa4-da6383f49e7f" class="">VPC Peering</h2><figure id="ec76e54d-b99e-450e-8799-12d2d2fb9410" class="image"><a href="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%209.png"><img style="width:1532px" src="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%209.png"/></a></figure><ul id="6bd3d71f-f3d1-40fd-8d9d-0544e9d3e9ed" class="bulleted-list"><li style="list-style-type:disc">Connect two VPCs (could be in <strong>different regions or accounts</strong>) using the AWS private network</li></ul><ul id="01c23a3f-79f7-4a44-8782-af262159b5fc" class="bulleted-list"><li style="list-style-type:disc">Participating VPCs must have <strong>non-overlapping CIDR</strong></li></ul><ul id="993822db-d4d0-4684-a6c0-e5146c55c8dd" class="bulleted-list"><li style="list-style-type:disc">VPC Peering connection is <strong>non-transitive</strong> (A - B, B - C != A - C) because it works based on route-table rules.</li></ul><ul id="499868dc-cc03-4aba-96df-fd259543f08d" class="toggle"><li><details open=""><summary>Must update route tables in each VPC’s subnets to ensure requests destined to the peered VPC can be routed through the peering connection</summary><figure id="cfb40406-4cef-4c56-9388-593bd335992e" class="image"><a href="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%2010.png"><img style="width:1570px" src="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%2010.png"/></a></figure><figure id="3bb11411-8fb7-4d77-abc9-1907af4cebb5" class="image"><a href="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%2011.png"><img style="width:1556px" src="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%2011.png"/></a></figure></details></li></ul><ul id="e14b3fc8-138f-4478-809b-b7f5f02cb8c4" class="bulleted-list"><li style="list-style-type:disc">You can reference a security group in a peered VPC across account or region. This allows us to use SG instead of CIDR when configuring rules.</li></ul><h2 id="20322a81-c483-41cb-b875-32d756ecc171" class="">VPC Endpoints</h2><figure id="ecb61a5d-fe69-4c57-b7b8-eefed49c36ba" class="image"><a href="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%2012.png"><img style="width:1652px" src="VPC%2052853e017ca04f19a83d64ee8663575f/Untitled%2012.png"/></a></figure><ul id="36aeb1ab-cb28-43c5-9a44-8fabe56b4191" class="bulleted-list"><li style="list-style-type:disc"><strong>Private endpoints</strong> within your VPC that allow AWS services to privately connect to resources within your VPC without traversing the public internet (cheaper)</li></ul><ul id="da0a0998-bcb0-4262-a7f4-2a7b9dab5fcc" class="bulleted-list"><li style="list-style-type:disc">Powered by <strong>AWS PrivateLink</strong></li></ul><ul id="8a73fd55-087c-4796-a6ad-ee0757558749" class="bulleted-list"><li style="list-style-type:disc"><strong>Route table is updated automatically</strong></li></ul><ul id="c229374f-c487-4c25-be3a-2f89dccd9ab1" class="bulleted-list"><li style="list-style-type:disc"><strong>Bound to a region</strong> (do not support inter-region communication)</li></ul><ul id="cf6a0e40-7346-47e3-b7cb-3e318f91833b" class="bulleted-list"><li style="list-style-type:disc">Need to create separate endpoints for different resources</li></ul><ul id="5c4281f7-3173-4376-9ddd-162f053f808e" class="bulleted-list"><li style="list-style-type:disc">Two types:<ul id="c6b216ff-739b-4afc-bdae-9ce18a284142" class="bulleted-list"><li style="list-style-type:circle"><strong>Interface Endpoint</strong><ul id="ee72c941-cb6e-4a58-86e4-74d278cd2df1" class="bulleted-list"><li style="list-style-type:square">Provisions an <strong>ENI</strong> (private IP) as an entry point per subnet</li></ul><ul id="ef00087c-37ab-4b4e-8784-6f55dcde84a6" class="bulleted-list"><li style="list-style-type:square">Need to <strong>attach a security group to the interface endpoint</strong> to control access</li></ul><ul id="8584d547-0d54-41fe-b7c4-fa35d96ba747" class="bulleted-list"><li style="list-style-type:square">Supports most AWS services</li></ul></li></ul><ul id="a211dc56-7382-45b1-82df-0a2f98d7ed5b" class="bulleted-list"><li style="list-style-type:circle"><strong>Gateway Endpoint</strong><ul id="2f83f06a-0ab6-462a-8bed-b0408299259a" class="bulleted-list"><li style="list-style-type:square">Provisions a gateway</li></ul><ul id="0d057b88-d9f5-4207-9d20-5858428d887c" class="bulleted-list"><li style="list-style-type:square">Must be used as a target in a route table</li></ul><ul id="067d7281-25e0-42cc-ad60-a80d34edf074" class="bulleted-list"><li style="list-style-type:square">Supports only <strong>S3</strong> and <strong>DynamoDB</strong></li></ul></li></ul></li></ul><h2 id="004afca1-d171-4a21-8ddd-0baf2efc25fd" class="">VPC Flow Logs</h2><ul id="3d565bf3-9fb0-43ce-941b-1b2d71ebf49e" class="bulleted-list"><li style="list-style-type:disc">Captures information about <strong>IP traffic</strong> going into your <strong>interfaces</strong></li></ul><ul id="1e8a59f2-742f-4408-94dd-553640ca5c21" class="bulleted-list"><li style="list-style-type:disc">Three levels:<ul id="1f72c819-f9a7-48b6-92c4-5a7e5b3fbd0f" class="bulleted-list"><li style="list-style-type:circle"><strong>VPC</strong> Flow Logs</li></ul><ul id="8f57cdd0-ab50-449c-ac56-d037bc444743" class="bulleted-list"><li style="list-style-type:circle"><strong>Subnet</strong> Flow Logs</li></ul><ul id="61a1a224-da33-40b7-b399-1fef3e388ef5" class="bulleted-list"><li style="list-style-type:circle"><strong>ENI</strong> Flow Logs</li></ul></li></ul><ul id="c962b736-7828-416f-bc13-c192f93671bc" class="bulleted-list"><li style="list-style-type:disc">Can be configured to show accepted, rejected or all traffic</li></ul><ul id="fea746e7-8676-448d-ba04-13c091a727a4" class="bulleted-list"><li style="list-style-type:disc">Flow logs data can be sent to <strong>S3</strong> (bulk analytics) or <strong>CloudWatch Logs</strong> (near real-time decision making)</li></ul><ul id="b12dacc7-5670-442d-88bd-5f7d1daf62d2" class="bulleted-list"><li style="list-style-type:disc">Query VPC flow logs using <strong>Athena</strong> in S3 or <strong>CloudWatch Logs Insights</strong></li></ul><h2 id="3e96cc90-cc61-44f9-b02e-e35cf286da39" class="">Connecting to On-Premise</h2><ul id="5ac91a02-aee8-4804-982f-fd6a3099215b" class="bulleted-list"><li style="list-style-type:disc"><strong>Site-to-site VPN</strong> - <strong>IPSec encrypted</strong> connection over the public internet</li></ul><ul id="f368cbc7-d1a9-480a-8041-bdf181999965" class="bulleted-list"><li style="list-style-type:disc"><strong>Direct Connect (DX)</strong> - Dedicated connection<ul id="e7d1613c-76ad-42af-8b71-d6b59033e6b6" class="bulleted-list"><li style="list-style-type:circle">Not encrypted (but private connection)</li></ul><ul id="7f8d4b32-36de-4c3a-8ddb-85b335679360" class="bulleted-list"><li style="list-style-type:circle">Takes about 30 days to setup</li></ul></li></ul><p id="8f01c27e-2361-4640-9dfa-2e0563f789ca" class="">
</p></div></article></body></html>